<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local LLM Benchmark Report</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'bg': 'var(--bg)',
                        'surface': 'var(--surface)',
                        'border': 'var(--border)',
                        'text': 'var(--text)',
                        'muted': 'var(--muted)',
                        'accent': '#f97316',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        serif: ['Georgia', 'Cambria', 'serif'],
                    },
                }
            }
        }
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Charts & Table -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest"></script>

    <style>
        :root {
            --bg: #f5f5f5;
            --surface: #ffffff;
            --border: #e5e5e5;
            --text: #171717;
            --muted: #737373;
        }
        .dark {
            --bg: #0a0a0a;
            --surface: #171717;
            --border: #262626;
            --text: #e5e5e5;
            --muted: #737373;
        }

        /* DataTable overrides */
        .datatable-wrapper .datatable-search input {
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
            font-size: 0.875rem;
            outline: none;
        }
        .datatable-wrapper .datatable-search input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);
        }
        .datatable-wrapper .datatable-top,
        .datatable-wrapper .datatable-bottom {
            padding: 0.75rem 0;
        }
        .datatable-wrapper .datatable-selector {
            padding: 0.375rem 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
        }
        .datatable-wrapper .datatable-pagination .datatable-pagination-list-item-link {
            padding: 0.375rem 0.75rem;
            border-radius: 0.375rem;
            color: var(--text);
        }
        .datatable-wrapper .datatable-pagination .datatable-pagination-list-item.datatable-active .datatable-pagination-list-item-link {
            background-color: #6366f1;
            color: white;
        }
        .datatable-wrapper .datatable-info {
            color: var(--muted);
        }

        /* Table styling */
        table.dataTable tbody tr:hover {
            background-color: var(--bg);
        }
        table.dataTable th {
            background-color: var(--bg);
            font-weight: 600;
            color: var(--muted);
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }
        table.dataTable td, table.dataTable th {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
        }
        table.dataTable td {
            color: var(--text);
        }
    </style>
</head>
<body class="bg-bg text-text font-sans antialiased transition-colors duration-300">

    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-bg/80 backdrop-blur-md border-b border-border">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 py-2 sm:py-3">
            <div class="flex items-center justify-between">
                <a href="https://eeshans.com" class="text-text hover:text-muted transition-colors font-serif text-base sm:text-lg">
                    <span class="font-normal text-muted">Sidequest by</span> <span class="font-semibold">eeshans.com</span>
                </a>
                <div class="flex items-center gap-2 sm:gap-5">
                    <a href="https://github.com/eeshansrivastava89/local-llm-bench" target="_blank" class="text-muted hover:text-text transition-colors text-sm hidden sm:block">GitHub</a>
                    <a href="https://0to1datascience.substack.com" target="_blank" class="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs sm:text-sm font-medium bg-[#FF6719] text-white rounded-full hover:bg-[#E55A15] transition-colors">
                        <svg class="h-3 w-3 sm:h-3.5 sm:w-3.5" viewBox="0 0 24 24" fill="currentColor"><path d="M22.539 8.242H1.46V5.406h21.08v2.836zM1.46 10.812V24L12 18.11 22.54 24V10.812H1.46zM22.54 0H1.46v2.836h21.08V0z"></path></svg>
                        Subscribe
                    </a>
                    <button id="themeToggle" class="p-1.5 rounded-md border border-border hover:bg-surface transition-all duration-200" aria-label="Toggle theme">
                        <svg class="w-4 h-4 text-muted dark:block hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <svg class="w-4 h-4 text-muted dark:hidden block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-20">

        <!-- Page Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-indigo-500 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-text">Local LLM Benchmark Report</h1>
                        <p class="text-sm text-muted">Local inference performance analysis</p>
                    </div>
                </div>
                <div class="text-right">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-surface border border-border text-text">
                        {{ total_runs }} runs
                    </span>
                </div>
            </div>

            <!-- System Info Bar -->
            <div class="bg-surface/50 rounded-lg border border-border p-4 mb-4">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                    <div>
                        <p class="text-muted text-xs uppercase tracking-wide mb-1">System</p>
                        <p class="text-text font-medium">{{ os_version }}</p>
                    </div>
                    <div>
                        <p class="text-muted text-xs uppercase tracking-wide mb-1">CPU</p>
                        <p class="text-text font-medium">{{ cpu }}</p>
                    </div>
                    <div>
                        <p class="text-muted text-xs uppercase tracking-wide mb-1">RAM</p>
                        <p class="text-text font-medium">{{ ram_gb }} GB</p>
                    </div>
                    <div>
                        <p class="text-muted text-xs uppercase tracking-wide mb-1">GPU</p>
                        <p class="text-text font-medium">{{ gpu }}</p>
                    </div>
                </div>
            </div>

            <!-- Meta info row -->
            <div class="flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-muted">
                <span class="flex items-center gap-1.5">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Last run: {{ last_run }}
                </span>
                <span class="flex items-center gap-1.5">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                    </svg>
                    Models tested: {{ models_tested }}
                </span>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-surface rounded-xl border border-border p-4">
                <p class="text-xs font-medium text-muted uppercase tracking-wide">Total Runs</p>
                <p class="text-2xl font-semibold text-text mt-1">{{ total_runs }}</p>
            </div>
            <div class="bg-surface rounded-xl border border-border p-4">
                <p class="text-xs font-medium text-muted uppercase tracking-wide">Best Avg F1</p>
                <p class="text-2xl font-semibold text-emerald-500 mt-1">{{ best_f1 }}%</p>
                <p class="text-xs text-muted mt-0.5">{{ best_f1_model }}</p>
            </div>
            <div class="bg-surface rounded-xl border border-border p-4">
                <p class="text-xs font-medium text-muted uppercase tracking-wide">Fastest Avg</p>
                <p class="text-2xl font-semibold text-indigo-500 mt-1">{{ fastest_time }}s</p>
                <p class="text-xs text-muted mt-0.5">{{ fastest_model }}</p>
            </div>
            <div class="bg-surface rounded-xl border border-border p-4">
                <p class="text-xs font-medium text-muted uppercase tracking-wide">Lowest Avg Memory</p>
                <p class="text-2xl font-semibold text-violet-500 mt-1">{{ lowest_memory }} GB</p>
                <p class="text-xs text-muted mt-0.5">{{ lowest_memory_model }}</p>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Time Series Chart -->
            <div class="bg-surface rounded-xl border border-border p-5">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-text">Metrics Over Time</h2>
                </div>
                <div class="flex items-center gap-4 mb-4">
                    <div class="flex items-center gap-1.5">
                        <label for="metric-select" class="text-xs font-medium text-muted">Metric:</label>
                        <select id="metric-select" onchange="updateCharts()" class="w-28 px-2 py-1 text-xs border border-border rounded-md bg-surface text-text focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="f1">F1 Score</option>
                            <option value="time_sec">Time (s)</option>
                            <option value="memory_delta_gb">Memory (GB)</option>
                            <option value="tokens">Tokens</option>
                            <option value="completion_tokens">Completion</option>
                        </select>
                    </div>
                    <div class="flex items-center gap-1.5">
                        <label for="model-select" class="text-xs font-medium text-muted">Model:</label>
                        <select id="model-select" onchange="updateCharts()" class="w-28 px-2 py-1 text-xs border border-border rounded-md bg-surface text-text focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="all">All</option>
                        </select>
                    </div>
                    <div class="flex items-center gap-1.5">
                        <label for="prompt-select" class="text-xs font-medium text-muted">Prompt:</label>
                        <select id="prompt-select" onchange="updateCharts()" class="w-24 px-2 py-1 text-xs border border-border rounded-md bg-surface text-text focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-mono">
                            <option value="all">All</option>
                        </select>
                    </div>
                </div>
                <div id="main-chart" class="h-80"></div>
            </div>

            <!-- Bubble Chart -->
            <div class="bg-surface rounded-xl border border-border p-5">
                <div class="mb-4">
                    <h2 class="text-lg font-semibold text-text">Model Comparison</h2>
                    <p class="text-sm text-muted mt-1">Bubble size = memory usage</p>
                </div>
                <div id="bubble-chart" class="h-80"></div>
            </div>
        </div>

        <!-- Results Table -->
        <div class="bg-surface rounded-xl border border-border p-5">
            <h2 class="text-lg font-semibold text-text mb-4">All Results</h2>
            <div class="overflow-x-auto">
                <table id="results-table" class="w-full">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Model</th>
                            <th>Backend</th>
                            <th>Time (s)</th>
                            <th>Memory (GB)</th>
                            <th>Tokens</th>
                            <th>F1</th>
                            <th>Precision</th>
                            <th>Recall</th>
                            <th>Prompt</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- Footer -->
    <footer class="border-t border-border mt-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4 text-xs text-muted">
                <p>&copy; 2026 Eeshan Srivastava. All rights reserved.</p>
                <p class="italic">Personal project &middot; MIT License &middot; Non-commercial</p>
                <div class="flex items-center gap-4">
                    <a href="https://github.com/eeshansrivastava89/local-llm-bench" target="_blank" class="hover:text-text transition-colors flex items-center gap-1.5">
                        <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                        Source
                    </a>
                    <a href="https://www.linkedin.com/in/eeshans/" target="_blank" class="hover:text-text transition-colors">
                        <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.06 2.06 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0z"/></svg>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            html.classList.add('dark');
        }
        themeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
            // Re-render charts with new theme
            updateCharts();
            renderBubbleChart();
        });

        const data = {{ data_json | safe }};

        // Get unique models and prompts
        const models = [...new Set(data.map(d => d.model_name))];
        const prompts = [...new Set(data.map(d => d.prompt_hash).filter(h => h))];

        // Populate model selector
        const modelSelect = document.getElementById('model-select');
        models.forEach(model => {
            const opt = document.createElement('option');
            opt.value = model;
            opt.textContent = model;
            modelSelect.appendChild(opt);
        });

        // Populate prompt selector (show hash only)
        const promptSelect = document.getElementById('prompt-select');
        prompts.forEach((hash) => {
            const opt = document.createElement('option');
            opt.value = hash;
            opt.textContent = hash.substring(0, 8);
            promptSelect.appendChild(opt);
        });

        // Color palette
        const colors = ['#6366f1', '#8b5cf6', '#06b6d4', '#f59e0b', '#10b981', '#f43f5e'];
        const modelColors = {};
        models.forEach((m, i) => modelColors[m] = colors[i % colors.length]);

        // Populate table
        const tbody = document.getElementById('table-body');
        data.forEach(row => {
            const tr = document.createElement('tr');
            const ts = row.timestamp ? row.timestamp.substring(0, 19).replace('T', ' ') : '-';
            const f1 = row.f1 ? (row.f1 * 100).toFixed(1) + '%' : '-';
            const prec = row.precision ? (row.precision * 100).toFixed(1) + '%' : '-';
            const rec = row.recall ? (row.recall * 100).toFixed(1) + '%' : '-';
            const statusClass = row.success ? 'text-emerald-500' : 'text-red-500';
            const statusIcon = row.success ? '&#10003;' : '&#10007;';
            const promptShort = row.prompt_hash ? row.prompt_hash.substring(0, 8) : '-';

            tr.innerHTML = `
                <td class="text-muted">${ts}</td>
                <td class="font-medium">${row.model_name || '-'}</td>
                <td><span class="px-2 py-0.5 text-xs font-medium rounded-full ${row.backend === 'mlx' ? 'bg-indigo-500/20 text-indigo-400' : 'bg-violet-500/20 text-violet-400'}">${row.backend || '-'}</span></td>
                <td>${row.time_sec ? row.time_sec.toFixed(1) : '-'}</td>
                <td>${row.memory_delta_gb ? row.memory_delta_gb.toFixed(2) : '-'}</td>
                <td>${row.tokens || '-'}</td>
                <td class="font-medium">${f1}</td>
                <td>${prec}</td>
                <td>${rec}</td>
                <td><code class="text-xs bg-bg px-1.5 py-0.5 rounded border border-border">${promptShort}</code></td>
                <td class="${statusClass} font-bold">${statusIcon}</td>
            `;
            tbody.appendChild(tr);
        });

        // Initialize DataTable
        const dataTable = new simpleDatatables.DataTable("#results-table", {
            searchable: true,
            sortable: true,
            perPage: 25,
            columns: [
                { select: 0, sort: "desc" }  // Sort by timestamp descending
            ]
        });

        // Get theme-aware colors
        function getPlotlyColors() {
            const isDark = document.documentElement.classList.contains('dark');
            return {
                bg: 'transparent',
                text: isDark ? '#e5e5e5' : '#171717',
                muted: '#737373',
                grid: isDark ? '#262626' : '#f4f4f5',
                line: isDark ? '#262626' : '#e4e4e7'
            };
        }

        // Plotly layout defaults
        function getPlotlyLayout() {
            const c = getPlotlyColors();
            return {
                font: { family: 'Inter, system-ui, sans-serif', color: c.text },
                paper_bgcolor: c.bg,
                plot_bgcolor: c.bg,
                margin: { t: 40, b: 60, l: 60, r: 20 }
            };
        }

        // Chart update function
        function updateCharts() {
            const metric = document.getElementById('metric-select').value;
            const selectedModel = document.getElementById('model-select').value;
            const selectedPrompt = document.getElementById('prompt-select').value;
            const c = getPlotlyColors();

            const metricLabels = {
                'f1': 'F1 Score',
                'time_sec': 'Time (seconds)',
                'memory_delta_gb': 'Memory Delta (GB)',
                'tokens': 'Total Tokens',
                'completion_tokens': 'Completion Tokens'
            };

            let filteredData = data;
            if (selectedPrompt !== 'all') {
                filteredData = data.filter(d => d.prompt_hash === selectedPrompt);
            }

            let traces = [];

            if (selectedModel === 'all') {
                models.forEach(model => {
                    const modelData = filteredData.filter(d => d.model_name === model && d.success);
                    if (modelData.length === 0) return;

                    traces.push({
                        x: modelData.map(d => d.timestamp),
                        y: modelData.map(d => metric === 'f1' ? (d[metric] || 0) * 100 : d[metric]),
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: model,
                        line: { color: modelColors[model], width: 2 },
                        marker: { size: 8 }
                    });
                });
            } else {
                const modelData = filteredData.filter(d => d.model_name === selectedModel && d.success);
                traces.push({
                    x: modelData.map(d => d.timestamp),
                    y: modelData.map(d => metric === 'f1' ? (d[metric] || 0) * 100 : d[metric]),
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: selectedModel,
                    line: { color: modelColors[selectedModel], width: 2 },
                    marker: { size: 8 }
                });
            }

            const layout = {
                ...getPlotlyLayout(),
                xaxis: {
                    title: { text: 'Time', font: { size: 12, color: c.muted } },
                    tickangle: -45,
                    gridcolor: c.grid,
                    linecolor: c.line,
                    tickfont: { color: c.muted }
                },
                yaxis: {
                    title: { text: metricLabels[metric] + (metric === 'f1' ? ' (%)' : ''), font: { size: 12, color: c.muted } },
                    rangemode: 'tozero',
                    gridcolor: c.grid,
                    linecolor: c.line,
                    tickfont: { color: c.muted }
                },
                legend: {
                    orientation: 'h',
                    y: -0.35,
                    font: { size: 11, color: c.text }
                },
                margin: { t: 40, b: 80, l: 60, r: 20 },
                hovermode: 'closest'
            };

            Plotly.newPlot('main-chart', traces, layout, {responsive: true, displayModeBar: false});
        }

        // Bubble chart
        function renderBubbleChart() {
            const c = getPlotlyColors();
            const modelStats = {};
            models.forEach(model => {
                const modelData = data.filter(d => d.model_name === model && d.success);
                if (modelData.length === 0) return;

                const avgTime = modelData.reduce((sum, d) => sum + (d.time_sec || 0), 0) / modelData.length;
                const avgF1 = modelData.reduce((sum, d) => sum + (d.f1 || 0), 0) / modelData.length;
                const avgMemory = modelData.reduce((sum, d) => sum + (d.memory_delta_gb || 0), 0) / modelData.length;
                const runs = modelData.length;

                modelStats[model] = { avgTime, avgF1, avgMemory, runs };
            });

            const activeModels = models.filter(m => modelStats[m]);

            const bubbleTrace = {
                x: activeModels.map(m => modelStats[m].avgTime),
                y: activeModels.map(m => modelStats[m].avgF1 * 100),
                mode: 'markers',
                marker: {
                    size: activeModels.map(m => {
                        const mem = modelStats[m].avgMemory || 1;
                        return Math.max(20, Math.min(50, mem * 2));
                    }),
                    color: activeModels.map((m, i) => colors[i % colors.length]),
                    opacity: 0.8,
                    line: { width: 1, color: 'white' }
                },
                hovertemplate: activeModels.map(m => {
                    const s = modelStats[m];
                    return `<b>${m}</b><br>` +
                           `Time: ${s.avgTime.toFixed(1)}s<br>` +
                           `F1: ${(s.avgF1 * 100).toFixed(1)}%<br>` +
                           `Memory: ${s.avgMemory.toFixed(1)} GB<br>` +
                           `Runs: ${s.runs}<extra></extra>`;
                }),
                showlegend: false
            };

            const times = activeModels.map(m => modelStats[m].avgTime);
            const maxTime = Math.max(...times) * 1.15;

            const bubbleLayout = {
                ...getPlotlyLayout(),
                margin: { t: 10, b: 50, l: 50, r: 20 },
                xaxis: {
                    title: { text: 'Average Time (seconds)', font: { size: 11, color: c.muted } },
                    range: [0, maxTime],
                    zeroline: false,
                    gridcolor: c.grid,
                    linecolor: c.line,
                    tickfont: { color: c.muted }
                },
                yaxis: {
                    title: { text: 'Average F1 Score (%)', font: { size: 11, color: c.muted } },
                    range: [0, 120],
                    tickvals: [0, 20, 40, 60, 80, 100],
                    gridcolor: c.grid,
                    linecolor: c.line,
                    tickfont: { color: c.muted }
                },
                hovermode: 'closest'
            };

            Plotly.newPlot('bubble-chart', [bubbleTrace], bubbleLayout, {responsive: true, displayModeBar: false});
        }

        // Initial chart render
        updateCharts();
        renderBubbleChart();
    </script>
</body>
</html>
